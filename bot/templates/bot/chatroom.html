<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <title>Document</title>

        <style>
            .wrapper {
                height: 100%;
                width: 100%;
                position: absolute;
                text-align: center;
            }
            .chat_area {
                top: 25%;
                position: relative;
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div class="chat_area">
                <textarea id="chat-log" cols="50" rows="25"></textarea><br />
                <input id="chat" type="text" size="47" />
                <input id="submit" type="button" value="â–¶" />
            </div>
        </div>
        <div id="hidden" hidden="true">{{user_name}}</div>
        <script>
            const chatSocket = new WebSocket(
                "ws://" + window.location.host + "/ws/chat/chatroom/"
            );

            chatSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                const message = data["message"];
                const textArea = document.querySelector("#chat-log");

                const timeNow = new Date()

                textArea.value +=`[${document.querySelector("#hidden").innerText}] ${timeNow.getHours()}:${timeNow.getMinutes()} : ${message}\n`;
                textArea.scrollTop = textArea.scrollHeight;
            };

            chatSocket.onclose = function (e) {
                console.error("Chat socket closed unexpectedly");
            };

            document.querySelector("#chat").focus();
            document.querySelector("#chat").onkeyup = function (e) {
                if (e.keyCode === 13) {
                    // enter, return
                    document.querySelector("#submit").click();
                }
            };

            document.querySelector("#submit").onclick = function (e) {
                const messageInputDom = document.querySelector("#chat");
                const message = messageInputDom.value;

                chatSocket.send(
                    JSON.stringify({
                        message: message,
                    })
                );

                messageInputDom.value = "";
            };
        </script>
    </body>
</html>
